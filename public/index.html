<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encrypted Chat</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>

<body>
    <div id="app">
        <!-- User Setup Dialog -->
        <div id="userSetupDialog" class="modal">
            <div class="modal-content">
                <h2>Welcome to Encrypted Chat</h2>
                <form id="userSetupForm">
                    <div class="form-group">
                        <label for="displayName">Display Name</label>
                        <input type="text" id="displayName" class="form-control" required minlength="2" maxlength="20">
                        <div class="error-message" id="displayNameError"></div>
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width">Continue</button>
                </form>
            </div>
        </div>

        <!-- Secret Key Dialog -->
        <div id="keyDialog" class="modal hidden">
            <div class="modal-content">
                <h2>Enter Secret Key</h2>
                <form id="keyForm">
                    <div class="form-group">
                        <label for="secretKey">Secret Key</label>
                        <input type="password" id="secretKey" class="form-control" required>
                        <div class="error-message" id="secretKeyError"></div>
                    </div>
                    <div class="form-buttons">
                        <button type="button" id="skipKeyBtn" class="btn btn--secondary">Skip</button>
                        <button type="submit" class="btn btn--primary">Set Key</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Main Chat Interface -->
        <div id="chatInterface" class="chat-container hidden">
            <!-- Header -->
            <div class="chat-header">
                <div class="chat-title">
                    <h3>Encrypted Group Chat</h3>
                    <div class="connection-status" id="connectionStatus">
                        <span class="status-dot"></span>
                        <span id="statusText">Connecting...</span>
                    </div>
                </div>
                <div class="header-actions">
                    <button id="voiceCallBtn" class="btn btn--outline btn--sm" title="Start Voice Call">
                        <span class="material-icons">call</span>
                        Call
                    </button>
                    <button id="changeKeyBtn" class="btn btn--outline btn--sm">
                        <span class="material-icons">vpn_key</span>
                        Key
                    </button>
                    <button id="logoutBtn" class="btn btn--outline btn--sm">
                        <span class="material-icons">logout</span>
                        Logout
                    </button>
                </div>
            </div>

            <!-- Messages Container -->
            <div class="messages-container" id="messagesContainer">
                <div class="messages-list" id="messagesList">
                    <!-- Messages will be rendered here -->
                </div>
            </div>

            <!-- Message Input -->
            <div class="message-input-container">
                <div class="message-input-wrapper">
                    <textarea id="messageInput" class="message-input"
                        placeholder="Type a message... (Shift+Enter for new line, Enter to send)" rows="1"
                        maxlength="1000"></textarea>
                    <button id="sendBtn" class="send-button" disabled>
                        <span class="material-icons">send</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Key Status Bar -->
        <div id="keyStatusBar" class="key-status-bar hidden">
            <div class="key-status-content">
                <span class="material-icons">lock</span>
                <span id="keyStatusText">No decryption key set - messages will appear encrypted</span>
                <button id="setKeyBtn" class="btn btn--sm btn--primary">Set Key</button>
            </div>
        </div>

        <!-- Voice Call Dialog -->
        <div id="voiceCallDialog" class="modal hidden">
            <div class="modal-content voice-call-modal">
                <div class="call-header">
                    <h3 id="callTitle">Voice Call</h3>
                    <div class="call-status" id="callStatus">Initializing...</div>
                </div>

                <div class="call-participants" id="callParticipants">
                    <!-- Participants will be added here -->
                </div>

                <div class="call-controls">
                    <button id="muteBtn" class="call-btn mute-btn" title="Mute/Unmute">
                        <span class="material-icons">mic</span>
                    </button>
                    <button id="endCallBtn" class="call-btn end-call-btn" title="End Call">
                        <span class="material-icons">call_end</span>
                    </button>
                    <button id="speakerBtn" class="call-btn speaker-btn" title="Speaker On/Off">
                        <span class="material-icons">volume_up</span>
                    </button>
                </div>

                <div class="call-info">
                    <div class="call-duration" id="callDuration">00:00</div>
                    <div class="participants-count" id="participantsCount">0 participants</div>
                </div>
            </div>
        </div>

        <!-- Incoming Call Dialog -->
        <div id="incomingCallDialog" class="modal hidden">
            <div class="modal-content incoming-call-modal">
                <div class="incoming-call-info">
                    <h3>Incoming Voice Call</h3>
                    <div class="caller-name" id="callerName">Unknown</div>
                    <div class="call-animation">
                        <div class="pulse-ring"></div>
                        <div class="pulse-ring pulse-ring-delay"></div>
                        <span class="material-icons call-icon">call</span>
                    </div>
                </div>

                <div class="incoming-call-controls">
                    <button id="declineCallBtn" class="call-btn decline-btn" title="Decline">
                        <span class="material-icons">call_end</span>
                    </button>
                    <button id="acceptCallBtn" class="call-btn accept-btn" title="Accept">
                        <span class="material-icons">call</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="app.js"></script>
</body>

</html>